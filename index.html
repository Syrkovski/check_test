        <p class="section-description">По умолчанию подставятся текущие дата и время, но при необходимости их можно изменить вручную.</p>
      <div class="notice" id="current-number">Номер генерируется автоматически по формуле YYYYMMDD-XXX, дата и время по умолчанию берутся текущие в момент создания PDF, но могут быть заданы вручную.</div>
        <div class="inline-fields" aria-describedby="payment-datetime-hint">
          <label>
            Дата платежа
            <input type="date" id="payment-date" name="payment-date" />
          </label>
          <label>
            Время платежа
            <input type="time" id="payment-time" name="payment-time" step="60" />
          </label>
          <button type="button" id="reset-payment-datetime">Сбросить на сейчас</button>
        </div>
        <p class="notice" id="payment-datetime-hint">По умолчанию подставляются текущие дата и время — при необходимости их можно изменить вручную.</p>
    const paymentDateInput = document.getElementById('payment-date');
    const paymentTimeInput = document.getElementById('payment-time');
    const resetPaymentDatetimeBtn = document.getElementById('reset-payment-datetime');
    function formatDateInputValue(date) {
      const d = date || new Date();
      const day = String(d.getDate()).padStart(2, '0');
      const month = String(d.getMonth() + 1).padStart(2, '0');
      const year = d.getFullYear();
      return `${year}-${month}-${day}`;
    }

    function formatDateFromInput(value) {
      if (!value) return null;
      const isoMatch = value.match(/^(\d{4})-(\d{2})-(\d{2})$/);
      if (isoMatch) {
        const [, year, month, day] = isoMatch;
        return `${day}.${month}.${year}`;
      }

      const ruMatch = value.match(/^(\d{2})\.(\d{2})\.(\d{4})$/);
      if (ruMatch) {
        return value;
      }

      return null;
    }

    function formatTimeFromInput(value) {
      if (!value) return null;
      const match = value.match(/^(\d{2}):(\d{2})$/);
      if (!match) return null;
      const [, hours, minutes] = match;
      const hrsNum = Number(hours);
      const minsNum = Number(minutes);
      if (hrsNum < 0 || hrsNum > 23 || minsNum < 0 || minsNum > 59) return null;
      return `${hours}:${minutes}`;
    }

    function resetPaymentDateTime(date) {
      const now = date || new Date();
      if (paymentDateInput) {
        paymentDateInput.value = formatDateInputValue(now);
      }
      if (paymentTimeInput) {
        paymentTimeInput.value = formatTime(now);
      }
    }
    function renderCurrentNumber() {
      const records = loadRecords();
      const today = new Date();
      const prefix = todayNumberPrefix(today);
      const overrides = loadSequenceOverrides();
      const overrideSeq = overrides[prefix];
      const number = nextNumber(records, today);
      const isManual = Number.isFinite(overrideSeq) && overrideSeq > 0;
      currentNumberEl.innerHTML = `
        <span class="number-display">
          <span>Следующий номер:</span>
          <span class="number-value">${number}</span>
          ${isManual ? '<span class="pill">ручной</span>' : ''}
        </span>
      `;

      if (numberPrefixInput) {
        numberPrefixInput.value = `${prefix}-`;
      }

      if (numberSequenceInput) {
        const suggested = Number.isFinite(overrideSeq) && overrideSeq > 0
          ? overrideSeq
          : maxSequenceForPrefix(records, prefix) + 1;
        numberSequenceInput.value = suggested;
    }
      const dateFromInput = formatDateFromInput(paymentDateInput?.value);
      const timeFromInput = formatTimeFromInput(paymentTimeInput?.value);

      if (paymentDateInput && paymentDateInput.value && !dateFromInput) {
        alert('Введите дату в формате ДД.ММ.ГГГГ или выберите её в календаре.');
        return;
      }

      if (paymentTimeInput && paymentTimeInput.value && !timeFromInput) {
        alert('Введите время в формате ЧЧ:ММ.');
        return;
      }

      const date = dateFromInput || formatDate(now);
      const time = timeFromInput || formatTime(now);
      resetPaymentDateTime();
    if (resetPaymentDatetimeBtn) {
      resetPaymentDatetimeBtn.addEventListener('click', () => resetPaymentDateTime());
    }

      resetPaymentDateTime();
